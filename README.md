# DeltaETM: Generalized Embedded Topic Model for RNA Velocity 


## Preliminaries

Motivating example balabala.... 
$N$ Cells $n$, $G$ Genes $g$, $d$ Topics $t$

- For the spliced count,
$$\mathbb{E}\left[X_{ng}^{spliced}|X_{ng}^{unspliced}, Z\right] = \sum_{t}h_{nt}\left(Z\right)f_{\theta}\left(\rho_{g} +\delta_{tg} \right)$$

- For the unspliced count,
$$\mathbb{E}\left[X_{ng}^{unspliced}|Z\right] = \sum_{k}h_{nt}\left(Z\right)f_{\theta}\left(\rho_{g}\right)$$


## Generative process

DeltaETM posit that observed UMI counts for cell $n$ and gene $g$, are generated by the following process
$$
\begin{aligned}
z_{n} & \sim \operatorname{Normal}(0, I) \\
h_{n} & \sim \operatorname{Softmax }\left(z_{n}\right) \\
\rho_{g}  &\text{\quad Gene-level transcioptional parameter }\\
\delta_{t g} &\text{\quad Gene-by-topic post-transcriptional modification }\\
x_{n g} & \sim \text { ObservationModel }\left(h_{n}, \rho_{g}, \delta_{tg}\right)
\end{aligned}
$$


The generative process of scVI uses two neural networks:
$$
\begin{aligned}
&w_{tg} = \rho_{g} + \delta_{tg} \\
&f_{\theta}\left(\rho, \delta\right) =  \sigma(\rho_{g} + \delta_{tg})_{t} = \frac{e^{w_{t}}}{\sum_{g=1}^{G} e^{w_{tg}}} \\
&f_{w}\left(z_{n}\right): \mathbb{R}^{d} \rightarrow \mathbb{R}^{g} \\
&f_{h}\left(z_{n}\right): \mathbb{R}^{d}  \rightarrow(0,1)^{T}\\


\end{aligned}
$$

The latent variables, along with their description are summarized in the following table:

| Latent Variables  | Descriptions  | Code variable (if different)  |
|---                |---            |---                            |
| $z_{n} \in \mathbb{R}^{d}$ | Low-dimensional representation capturing the state of a cell.  |  |
|  $h_{n} \in \Delta^{d-1}$ | Topic proportion of of a cell, this is a vector sums up to within a cell, which is obtained by applyinng $\operatorname{Softmax}$ to $z_{n}$ |   |
| $\rho \in \mathbb{R}^{G}$  |  Gene-level transcioptional factor shared between unspliced and unspliced counts for each gene |   |
| $\delta \in \mathbb{R}^{d\times G}$  |  Post-transcriptional modification per topic for each gene |   |

## Some implications

When we only have gene-level effect, for example in reconstructing unspliced count, it means all topics has the same gene loadings in the unspliced counts. 